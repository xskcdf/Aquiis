
@namespace Aquiis.UI.Shared.Components.Entities.Leases

<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Lease Information</h5>
        <span class="badge @GetStatusBadgeClass(Lease.Status)">
            @Lease.Status
        </span>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6 mb-3">
                <strong>Property:</strong>
                <p>@Lease.Property?.Address</p>
                <small class="text-muted">@Lease.Property?.City, @Lease.Property?.State</small>
            </div>
            <div class="col-md-6 mb-3">
                <strong>Tenant:</strong>
                @if (Lease.Tenant != null)
                {
                    <p>@Lease.Tenant.FullName</p>
                    <small class="text-muted">@Lease.Tenant.Email</small>
                }
                else
                {
                    <p class="text-warning"><i class="bi bi-hourglass-split"></i> Lease Offer - Awaiting Acceptance</p>
                    <small class="text-muted">Tenant will be assigned upon acceptance</small>
                }
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <strong>Start Date:</strong>
                <p>@Lease.StartDate.ToString("MMMM dd, yyyy")</p>
            </div>
            <div class="col-md-6 mb-3">
                <strong>End Date:</strong>
                <p>@Lease.EndDate.ToString("MMMM dd, yyyy")</p>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <strong>Monthly Rent:</strong>
                <p class="text-success fw-bold">@Lease.MonthlyRent.ToString("C")</p>
            </div>
            <div class="col-md-6 mb-3">
                <strong>Security Deposit:</strong>
                <p>@Lease.SecurityDeposit.ToString("C")</p>
            </div>
        </div>

        @if (!string.IsNullOrEmpty(Lease.Terms))
        {
            <div class="row">
                <div class="col-md-12 mb-3">
                    <strong>Lease Terms:</strong>
                    <p>@Lease.Terms</p>
                </div>
            </div>
        }

        @if (!string.IsNullOrEmpty(Lease.Notes))
        {
            <div class="row">
                <div class="col-md-12 mb-3">
                    <strong>Notes:</strong>
                    <p>@Lease.Notes</p>
                </div>
            </div>
        }

        <div class="row">
            <div class="col-md-6 mb-3">
                <strong>Created:</strong>
                <p>@Lease.CreatedOn.ToString("MMMM dd, yyyy")</p>
            </div>
            @if (Lease.LastModifiedOn.HasValue)
            {
                <div class="col-md-6 mb-3">
                    <strong>Last Modified:</strong>
                    <p>@Lease.LastModifiedOn.Value.ToString("MMMM dd, yyyy")</p>
                </div>
            }
        </div>

        @if (Lease.IsActive)
        {
            <div class="row">
                <div class="col-md-12">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>Active Lease:</strong> This lease is currently active with @Lease.DaysRemaining days remaining.
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@code {
    [Parameter, EditorRequired]
    public Lease Lease { get; set; }

    private List<Invoice> recentInvoices = new List<Invoice>();

    protected override void OnInitialized()
    {
        recentInvoices = Lease.Invoices?
            .OrderByDescending(i => i.InvoicedOn)
            .ToList() ?? new List<Invoice>();
    }

    private string GetStatusBadgeClass(string status)
    {
        return status switch
        {
            "Active" => "bg-success",
            "Pending" => "bg-warning",
            "Expired" => "bg-secondary",
            "Terminated" => "bg-danger",
            _ => "bg-secondary"
        };
    }

    private string GetRenewalStatusBadgeClass(string status)
    {
        return status switch
        {
            "Pending" => "secondary",
            "Offered" => "info",
            "Accepted" => "success",
            "Declined" => "danger",
            "Expired" => "dark",
            _ => "secondary"
        };
    }

}