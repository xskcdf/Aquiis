@namespace Aquiis.UI.Shared.Components.Entities.Properties
@using Aquiis.Core.Entities
@using Aquiis.Core.Constants

<div class="card h-100">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-start mb-2">
            <h5 class="card-title">@Address</h5>
            <span class="badge @GetStatusBadgeClass()">
                @Status
            </span>
        </div>
        <p class="text-muted mb-2">@City, @State @ZipCode</p>
        
        @if (!string.IsNullOrWhiteSpace(Description))
        {
            <p class="card-text mb-2">@Description</p>
        }
        
        <div class="row text-center mb-3">
            <div class="col-4">
                <small class="text-muted">Bedrooms</small>
                <div class="fw-bold">@Bedrooms</div>
            </div>
            <div class="col-4">
                <small class="text-muted">Bathrooms</small>
                <div class="fw-bold">@Bathrooms</div>
            </div>
            <div class="col-4">
                <small class="text-muted">Sq Ft</small>
                <div class="fw-bold">@SquareFeet.ToString("N0")</div>
            </div>
        </div>
        
        <div class="text-center mb-3">
            <span class="h4 text-primary">@MonthlyRent.ToString("C")</span>
            <small class="text-muted">/month</small>
        </div>
    </div>
    
    @if (ShowActions)
    {
        <div class="card-footer">
            <div class="btn-group w-100">
                <button class="btn btn-outline-primary" @onclick="HandleView">
                    <i class="bi bi-eye"></i> View
                </button>
                @if (ShowEditDelete)
                {
                    <button class="btn btn-outline-secondary" @onclick="HandleEdit">
                        <i class="bi bi-pencil"></i> Edit
                    </button>
                    <button class="btn btn-outline-danger" 
                            @onclick="HandleDelete">
                        <i class="bi bi-trash"></i> Delete
                    </button>
                }
            </div>
        </div>
    }
</div>

@code {
    /// <summary>
    /// Property ID
    /// </summary>
    [Parameter, EditorRequired]
    public Guid PropertyId { get; set; }
    
    /// <summary>
    /// Property address
    /// </summary>
    [Parameter, EditorRequired]
    public string Address { get; set; } = string.Empty;
    
    /// <summary>
    /// Unit number (optional)
    /// </summary>
    [Parameter]
    public string? UnitNumber { get; set; }
    
    /// <summary>
    /// City
    /// </summary>
    [Parameter, EditorRequired]
    public string City { get; set; } = string.Empty;
    
    /// <summary>
    /// State
    /// </summary>
    [Parameter, EditorRequired]
    public string State { get; set; } = string.Empty;
    
    /// <summary>
    /// Zip code
    /// </summary>
    [Parameter, EditorRequired]
    public string ZipCode { get; set; } = string.Empty;
    
    /// <summary>
    /// Property description
    /// </summary>
    [Parameter]
    public string? Description { get; set; }
    
    /// <summary>
    /// Number of bedrooms
    /// </summary>
    [Parameter]
    public int Bedrooms { get; set; }
    
    /// <summary>
    /// Number of bathrooms
    /// </summary>
    [Parameter]
    public decimal Bathrooms { get; set; }
    
    /// <summary>
    /// Square footage
    /// </summary>
    [Parameter]
    public int SquareFeet { get; set; }
    
    /// <summary>
    /// Monthly rent amount
    /// </summary>
    [Parameter]
    public decimal MonthlyRent { get; set; }
    
    /// <summary>
    /// Property status
    /// </summary>
    [Parameter, EditorRequired]
    public string Status { get; set; } = string.Empty;
    
    /// <summary>
    /// Whether to show action buttons
    /// </summary>
    [Parameter]
    public bool ShowActions { get; set; } = true;
    
    /// <summary>
    /// Whether to show edit/delete buttons (requires ShowActions = true)
    /// </summary>
    [Parameter]
    public bool ShowEditDelete { get; set; } = true;
    
    /// <summary>
    /// Callback when View button is clicked
    /// </summary>
    [Parameter]
    public EventCallback<Guid> OnView { get; set; }
    
    /// <summary>
    /// Callback when Edit button is clicked
    /// </summary>
    [Parameter]
    public EventCallback<Guid> OnEdit { get; set; }
    
    /// <summary>
    /// Callback when Delete button is clicked
    /// </summary>
    [Parameter]
    public EventCallback<Guid> OnDelete { get; set; }
    
    private string DisplayAddress => string.IsNullOrWhiteSpace(UnitNumber) 
        ? Address 
        : $"{Address}, {UnitNumber}";
    
    private async Task HandleView()
    {
        await OnView.InvokeAsync(PropertyId);
    }
    
    private async Task HandleEdit()
    {
        await OnEdit.InvokeAsync(PropertyId);
    }
    
    private async Task HandleDelete()
    {
        await OnDelete.InvokeAsync(PropertyId);
    }
    
    private string GetStatusBadgeClass()
    {
        return Status switch
        {
            var s when s == ApplicationConstants.PropertyStatuses.Available => "bg-success",
            var s when s == ApplicationConstants.PropertyStatuses.ApplicationPending => "bg-info",
            var s when s == ApplicationConstants.PropertyStatuses.LeasePending => "bg-warning",
            var s when s == ApplicationConstants.PropertyStatuses.Occupied => "bg-danger",
            var s when s == ApplicationConstants.PropertyStatuses.UnderRenovation => "bg-secondary",
            var s when s == ApplicationConstants.PropertyStatuses.OffMarket => "bg-dark",
            _ => "bg-secondary"
        };
    }
}
